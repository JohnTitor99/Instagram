{% extends 'main.html' %}
{% load static %}

{% block content %}

<!-- USER IS NOT AUTHENTICATED -->
{% if not user.is_authenticated %}

    {% if page == 'login' %}
        <div class="start-login-page">
            <form method="POST" name="login-form">
                {% csrf_token %}
                <p>
                    <label>Username</label>
                    <input type="text" name="username" placeholder="Enter a username..." />
                </p>

                <p>
                    <label>Password</label>
                    <input type=text/ name="password" placeholder="Enter a password..." />
                </p>

                <input type="submit" value="submit" name="login-form" />
            </form>

            <a href="{% url 'register_page' %}">Haven't sign up yet?</a>
        </div>
    {% else %}
        <div class="register-page">
            <form method="POST" name="register-form">
                {% csrf_token %}
                {{ form.as_p }}
                <input type="submit" value="Register" name="register-form" />
            </form>
            <p>Already signed up?</p>
            <a href="{% url 'main_page' %}">Login</a>
        </div>
    {% endif %}

<!-- USER IS AUTHENTICATED -->
{% else %}

    <div class="main-container">
        <div>

        </div>

        <div class="posts-tape">
            {% for post in posts %}
                <div class="post">
                    <!-- OWNER'S POSTS HEADER AND OPTIONS -->
                    {% if post.user == request.user %}

                        <div class="post-header">
                            <a href=""><img src="{{ post.logo.url }}"/><p>{{ post.user }}</p></a> <button onclick="hidePopupFunc(); postOptionsFunc('{{ post.id }}')" class="dropbtn post-options-dropbtn">···</button>
                        </div>

                        <!-- DROPDOWN OWNER'S POSTS OPTIONS -->
                        <div class="dropdown">
                            <div id="postOptionsDropdown{{ post.id }}" class="dropdown-content post-options-dropdown-content">
                                <a href="javascript:postDeleteFunc('{{ post.id }}')" class="dropbtn">Delete</a>
                                <hr>
                                <a href="javascript:postEditFunc('{{ post.id }}')" class="dropbtn">Edit</a>
                                <hr>
                                <a href="">Hide like count</a>
                                <hr>
                                <a href="">Turn off commenting</a>
                                <hr>
                                <a href="">Go to post</a>
                                <hr>
                                <a href="">Share to...</a>
                                <hr>
                                <a href="">Copy link</a>
                                <hr>
                                <a href="">Embed</a>
                                <hr>
                                <a href="javascript:hidePopupFunc()">Cancel</a>
                            </div>
                        </div>

                        <!-- OPTION ACTIONS OWNER'S POST -->

                        <!-- post delete -->
                        <div class="dropdown">
                            <div id="postDeleteDropdown{{ post.id }}" class="dropdown-content post-delete-dropdown-content">
                                <h2>Delete post?</h2>
                                <p>Are you sure you want to delete this post?</p>
                                <hr>
                                <a href="{% url 'delete_post' post.id %}">Delete</a>
                                <hr>
                                <a href="javascript:hidePopupFunc()">Cancel</a>
                            </div>
                        </div>

                        <!-- post edit -->
                        <div class="dropdown">
                            <div id="postEditDropdown{{ post.id }}" class="dropdown-content post-edit-dropdown-content">
                                <div class="edit-post-header-left">
                                    <a href="">Cancel</a>
                                </div>

                                <div class="edit-post-header-right">
                                    
                                </div>

                                <div class="edit-post-header-center">
                                    Edit Info
                                </div>

                                <hr>
                                
                                <div class="edit-post-body">
                                    <div class="edit-post-image">
                                        <img src="{{ post.image.url }}"/>
                                    </div>

                                    <div class="edit-post-logo-username-text">
                                        <img src="{{ post.logo.url }}"/><p>{{ post.user }}</p>
                                        <div class="edit-text-form">
                                            <form method="POST" name="post-edit-form">
                                                {% csrf_token %}
                                                <textarea name="post-text">{{ post.post_text }}</textarea>
                                                <input type="hidden" name="post-id" value="{{ post.id }}">
                                                <button type="submit" name="post-edit-form">Done</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    <!-- OTHER POST HEADER AND OPTIONS -->
                    {% else %}
                    
                        <div class="post-header">
                            <a href=""><img src="{{ post.logo.url }}"/><p>{{ post.user }}</p></a> <button onclick="hidePopupFunc(); postOptionsFunc2('{{ post.id }}')" class="dropbtn post-options-dropbtn">···</button>
                        </div>

                        <!-- DROPDOWN OTHER POST OPTIONS -->
                        <div class="dropdown">
                            <div id="postOptionsDropdown2{{ post.id }}" class="dropdown-content post-options-dropdown-content">
                                <a href="">Report</a>
                                <hr>
                                <a href="">Unfollow</a>
                                <hr>
                                <a href="">Go to post</a>
                                <hr>
                                <a href="">Share to...</a>
                                <hr>
                                <a href="">Copy link</a>
                                <hr>
                                <a href="">Embed</a>
                                <hr>
                                <a href="javascript:hidePopupFunc()">Cancel</a>
                            </div>
                        </div>
                    {% endif %}
                    
                    <!-- POST BODY -->
                    <div class="post-body">
                        <img src="{{ post.image.url }}" class="post-image"/>
  
                        <!-- likes comments share save buttons -->
                        <form action="{% url 'post_action' post.id %}" method="POST">
                            {% csrf_token %}
                            <button type="submit" name="actionbtn" value="like" class="post-action post-like-dropbtn">
                                <img src="{% static 'media/icons/like_icon.png' %}" class="post-action-icon"/>
                            </button>
                            <button type="submit" name="actionbtn" value="save" class="post-action post-save-dropbtn">
                                <img src="{% static 'media/icons/save_icon.png' %}" class="post-action-icon"/>
                            </button>
                        </form>

                        <!-- post comments -->
                        <input type="image" onclick="hidePopupFunc(); postCommentsFunc('{{ post.id }}')" class="dropbtn post-action post-comments-dropbtn" src="{% static 'media/icons/comment_icon.png' %}" />

                        <!-- post comments dropdown -->
                        <div class="dropdown">
                            <div id="postCommentsDropdown{{ post.id }}" class="dropdown-content post-comments-dropdown-content">
                                <div class="post-comments-body">
                                    <div class="post-comments-image">
                                        <img src="{{ post.image.url }}"/>
                                    </div>

                                    <div class="post-comments-logo-username">
                                        <a href=""><img src="{{ post.logo.url }}"/><b>{{ post.user }}</b></a>
                                        {% if post.user == request.user %}
                                            <button onclick="postOptionsFunc('{{ post.id }}')" class="dropbtn post-comments-options-dropbtn">···</button>
                                        {% else %}
                                            <button onclick="postOptionsFunc2('{{ post.id }}')" class="dropbtn post-comments-options-dropbtn">···</button>
                                        {% endif %}
                                        <hr>
                                        <a href=""><img src="{{ post.logo.url }}"/><b>{{ post.user }}</b></a><p>{{ post.post_text }}</p>

                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- post share -->
                        <input type="image" onclick="" class="dropbtn post-action post-share-dropbtn" src="{% static 'media/icons/share_icon.png' %}" />
                        
                        
                        <p><b>{{ post.total_likes }} likes</b></p>
                        <p><b>{{ post.user }}</b> {{ post.post_text }}</p>
                        <p>{{ post.created | timesince }} ago </p>
                    </div>

                </div>
                
            {% endfor %}
        </div>

        <div class="side-panel">
            {% if request.user.is_authenticated %}
            <div class="avatar">
                <a href="">
                    <img src="{{ user_profile.logo.url }}"/> <p>{{ request.user }}</p> <p>Switch</p>
                </a>
            </div>

            <div class="suggestions">
                <p>Suggestions for you <a href="">See All</a></p>
            </div>
            {% endif %}
        </div>

        <div>

        </div>
    </div>
    
{% endif %}

{% endblock %}

